---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

const printerImages = import.meta.glob<{ default: ImageMetadata }>(
  '../../assets/images/printers/*.png',
  { eager: true }
);

const featured = new Set([
  'voron-24r2',
  'creality-k1',
  'flashforge-adventurer-5m',
  'prusa-mk4',
  'qidi-x-plus-3',
  'creality-ender-3',
]);

// Build printer entries with name and featured status
const printers = Object.entries(printerImages).map(([path, mod]) => {
  const filename = path.split('/').pop()?.replace('.png', '') ?? '';
  const displayName = filename
    .replace(/-/g, ' ')
    .replace(/_/g, ' ')
    .replace(/\b\w/g, (c: string) => c.toUpperCase());
  return {
    name: displayName,
    slug: filename,
    image: mod.default,
    isFeatured: featured.has(filename),
  };
});

// Sort: featured first, then alphabetical
printers.sort((a, b) => {
  if (a.isFeatured && !b.isFeatured) return -1;
  if (!a.isFeatured && b.isFeatured) return 1;
  return a.name.localeCompare(b.name);
});

const platforms = [
  { name: 'Raspberry Pi', arch: 'armv7l / aarch64' },
  { name: 'Creality K1 Series', arch: 'aarch64' },
  { name: 'FlashForge AD5M', arch: 'armv7l' },
];
---

<section class="py-20 md:py-32 px-4">
  <div class="max-w-5xl mx-auto">
    <!-- Section heading -->
    <h2 class="font-heading text-2xl md:text-4xl font-medium text-text-primary text-center mb-14">
      Runs on your printer
    </h2>

    <!-- Printer constellation -->
    <div class="flex flex-wrap justify-center gap-4 md:gap-5 mb-16">
      {printers.map((printer) => (
        <div
          class:list={[
            'printer-icon group relative flex items-center justify-center rounded-full bg-surface border border-border transition-all duration-200',
            printer.isFeatured
              ? 'w-16 h-16 md:w-[72px] md:h-[72px] opacity-100'
              : 'w-11 h-11 md:w-12 md:h-12 opacity-60 hover:opacity-100',
          ]}
        >
          <Image
            src={printer.image}
            alt={printer.name}
            width={printer.isFeatured ? 44 : 28}
            class="h-auto pointer-events-none"
          />
          <span class="printer-tooltip absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap bg-surface border border-border text-text-secondary text-xs px-2 py-0.5 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10">
            {printer.name}
          </span>
        </div>
      ))}
    </div>

    <!-- Platform badges -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-3xl mx-auto">
      {platforms.map((platform) => (
        <div class="bg-surface border border-border border-l-2 border-l-accent rounded-lg px-5 py-4">
          <span class="font-heading text-text-primary text-sm font-medium block">{platform.name}</span>
          <span class="font-mono text-text-muted text-xs mt-1 block">{platform.arch}</span>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .printer-icon:hover {
    transform: scale(1.1);
    border-color: var(--color-accent);
  }
</style>
